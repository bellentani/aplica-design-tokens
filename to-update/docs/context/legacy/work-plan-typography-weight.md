# Work Plan - Font Rendering Correction (Font Weight)

## ðŸŽ¯ **Objective**

Fix font weight rendering across the entire design tokens system, ensuring that font weights (font-weight) are generated as CSS numbers instead of strings in ALL transformation outputs (JSON, MJS, JS, TS, CSS). This requires implementing Style Dictionary transformations that work across all platforms before focusing on CSS-specific generation.

## ðŸ“Š **Current Status**

**Start Date**: October 8, 2025  
**Status**: âœ… **COMPLETED** - October 10, 2025  
**Priority**: High
**Impact**: All token transformations (JSON, MJS, JS, TS) and existing/future components

### **âœ… RESOLVED ISSUES**
- Font weights now generate as CSS numbers (700, 300, 400, 600, 900) instead of strings
- All platforms (JSON, MJS, CJS) correctly transform font weights
- Semantic layer outputs raw values with proper font-weight transformation
- Foundation layer outputs aliases referencing semantic layer
- Build system architecture simplified and optimized

---

## ðŸŽ‰ **SOLUTION IMPLEMENTED**

### **Architecture Changes**
1. **Semantic Layer**: Outputs raw values (resolved) with font-weight transformation
2. **Foundation Layer**: Outputs aliases referencing semantic layer
3. **Build System**: Simplified to single `build.mjs` with clear commands
4. **File Structure**: 
   - Semantic files in root `/dist/` (e.g., `ze-light-positive.json`)
   - Foundation files in `/dist/foundation/` (e.g., `foundation.json`)

### **Technical Implementation**
- **Custom Format**: `json/semantic-only` for semantic layer filtering
- **Font-Weight Transform**: Applied in custom formats for all platforms
- **Build Commands**: `npm run build:semantic`, `npm run build:foundation`
- **Alias Resolution**: Foundation references semantic with `{semantic.color...}` syntax

### **Verification Results**
- âœ… Semantic: Raw values (`#ffcc00`, `700`, `300`)
- âœ… Foundation: Aliases (`{semantic.color.brand.ambient.contrast.deep.background}`)
- âœ… Font-weights: Numbers (`700`, `300`, `400`, `600`, `900`)
- âœ… All platforms: JSON, MJS, CJS working correctly

---

## ðŸ” **Identified Problem**

### **Current Situation**

- **Weights as strings**: Tokens define weights as `"SemiBold"`, `"Bold"`, `"Regular"` instead of CSS numbers
- **Missing transformation**: Style Dictionary doesn't convert names to numbers automatically
- **All platforms affected**: JSON, MJS, JS, TS outputs all contain string weights instead of numbers
- **CSS inconsistency**: `generate-css-vars.js` has manual mapping that may not be used correctly
- **Upper layers**: Use of String values instead of numbers for font weights across all transformation outputs

### **Affected Files**

```
packages/tokens/tokens/brand/ze/_other_elements.json     # Source definitions
packages/tokens/tokens/semantic/default.json            # Semantic tokens
packages/tokens/transformers/base-config.mjs            # Style Dictionary configuration
packages/tokens/transformers/build.mjs                  # Main build script
packages/tokens/transformers/build-unified.mjs          # Unified build system
packages/ui/scripts/generate-css-vars.js                # CSS generator

# Generated files (for reference only - auto-generated by transformers):
packages/tokens/dist/foundation/ze-foundation.mjs       # Generated tokens
packages/tokens/dist/json/*.json                        # All JSON outputs
packages/tokens/dist/*.mjs                              # All MJS outputs
packages/tokens/dist/*.js                               # All JS outputs
packages/tokens/dist/*.d.ts                             # All TS declaration outputs
```

### **Problem Example**

```json
// âŒ Current (String)
{
  "semibold": {
    "normal": {
      "$type": "fontWeights",
      "$value": "SemiBold"
    }
  }
}

// âœ… Desired (Number)
{
  "semibold": {
    "normal": {
      "$type": "fontWeights",
      "$value": 600
    }
  }
}
```

---

## ðŸŽ¯ **Specific Objectives**

1. **Structured Mapping**: Create comprehensive system to map names â†’ CSS numbers
2. **Style Dictionary Transformation**: Implement automatic transformation in token layer that works across ALL platforms
3. **All Platform Coverage**: Ensure JSON, MJS, JS, TS outputs all use numeric font weights
4. **String Elimination**: Stop using String values for weights in ALL transformation outputs
5. **CSS Integration**: Update CSS generator to use numeric tokens from other platforms
6. **Radix Integration**: Ensure correct export for consumption in Radix layer
7. **Compatibility**: Maintain functionality of existing components

---

## ðŸ“‹ **Execution Plan**

### **Phase 1: Analysis and Mapping** ðŸš§ (In Progress)

#### **1.1 Current Structure Analysis**

- [x] Identify where weights are being defined
- [ðŸš§] Map current transformation flow (IN PROGRESS)
- [ ] Document affected files
- [ ] Identify dependencies

#### **1.2 Weight Mapping**

- [ ] Create complete mapping of names â†’ CSS numbers
- [ ] Identify italic variants
- [ ] Document naming patterns
- [ ] Validate mapping with CSS specifications

**Identified Mapping**:

```javascript
const fontWeightMapping = {
  // Roboto Flex / Source Code Pro
  Light: 300,
  Regular: 400,
  SemiBold: 600,
  Bold: 700,
  Black: 900,

  // Variantes italic
  "Light Italic": "300 italic",
  Italic: "400 italic",
  "SemiBold Italic": "600 italic",
  "Bold Italic": "700 italic",
  "Black Italic": "900 italic",
};
```

### **Phase 2: Transformation Implementation** â³ (Pending)

#### **2.1 Create Style Dictionary Transformation**

- [ ] Implement `fontWeight/number` transform in `base-config.mjs`
- [ ] Configure transform to process `fontWeights` tokens
- [ ] Test transformation with local build
- [ ] Validate numeric output across ALL platforms (JSON, MJS, JS, TS)

#### **2.2 Update Configuration**

- [ ] Add transform to transformation groups in `base-config.mjs`
- [ ] Update `build.mjs` and `build-unified.mjs` to use new transform
- [ ] Configure execution order for all platforms
- [ ] Test with different platforms (JSON, MJS, JS, TS, CSS)
- [ ] Document configuration

### **Phase 3: Token Updates** â³ (Pending)

#### **3.1 Modify Source Tokens**

- [ ] Update `packages/tokens/tokens/brand/ze/_other_elements.json`
- [ ] Update `packages/tokens/tokens/brand/theme_engine/_other_elements.json`
- [ ] Maintain compatibility with current system
- [ ] Validate that all weights are mapped

#### **3.2 Rebuild and Validation**

- [ ] Execute complete token build using `build.mjs`
- [ ] Check generated tokens in `dist/` across all platforms
- [ ] Validate that numbers are being generated in JSON, MJS, JS, TS outputs
- [ ] Test reference resolution across all platforms
- [ ] Verify semantic and foundation tokens are correctly transformed

### **Phase 4: CSS Integration** â³ (Pending)

#### **4.1 Update CSS Generator**

- [ ] Modify `packages/ui/scripts/generate-css-vars.js`
- [ ] Remove unnecessary manual mapping
- [ ] Use numeric tokens from JSON/MJS outputs directly
- [ ] Test CSS variables generation
- [ ] Ensure CSS uses same numeric values as other platforms

#### **4.2 CSS Validation**

- [ ] Check generated CSS variables
- [ ] Test application in components
- [ ] Validate browser rendering
- [ ] Compare with previous implementation
- [ ] Verify consistency with JSON/MJS/JS/TS outputs

### **Phase 5: Validation and Documentation** â³ (Pending)

#### **5.1 Integration Tests**

- [ ] Test rendering in Storybook
- [ ] Check compatibility with Button component
- [ ] Test with different themes (positive/negative)
- [ ] Validate performance

#### **5.2 Documentation**

- [ ] Update technical documentation
- [ ] Create migration guide
- [ ] Document new patterns
- [ ] Update examples

---

## ðŸ”§ **Technical Implementation**

### **Style Dictionary Transformation**

```javascript
// transformers/base-config.mjs
StyleDictionary.registerTransform({
  name: "fontWeight/number",
  type: "value",
  matcher: (token) => token.type === "fontWeights",
  transformer: (token) => {
    const fontWeightMap = {
      Light: 300,
      Regular: 400,
      SemiBold: 600,
      Bold: 700,
      Black: 900,
      "Light Italic": "300 italic",
      Italic: "400 italic",
      "SemiBold Italic": "600 italic",
      "Bold Italic": "700 italic",
      "Black Italic": "900 italic",
    };

    return fontWeightMap[token.value] || token.value;
  },
});
```

### **Token Updates**

```json
// Before
{
  "semibold": {
    "normal": {
      "$type": "fontWeights",
      "$value": "SemiBold"
    }
  }
}

// After
{
  "semibold": {
    "normal": {
      "$type": "fontWeights",
      "$value": 600
    }
  }
}
```

### **Resulting CSS Variables**

```css
/* Before */
--foundation-typography-heading-title-1: Bold 24px/32px "Roboto Flex";

/* After */
--foundation-typography-heading-title-1: 700 24px/32px "Roboto Flex";
```

---

## ðŸ“Š **Success Metrics**

### **Acceptance Criteria**

- [ ] All font weights are valid CSS numbers
- [ ] Transformation works on all platforms (JSON, JS, CSS)
- [ ] Existing components continue to work
- [ ] CSS variables are generated correctly
- [ ] Font rendering is consistent

### **Technical Metrics**

- [ ] 100% of `fontWeights` tokens are numbers
- [ ] 0% weight strings in upper layers
- [ ] Build time maintained or improved
- [ ] Bundle size not negatively impacted

### **Quality Metrics**

- [ ] Storybook renders fonts correctly
- [ ] Button component maintains appearance
- [ ] Positive/negative themes work
- [ ] Accessibility maintained

---

## ðŸš¨ **Risks and Mitigations**

### **Identified Risks**

1. **Breaking Changes**: Components may break with type changes
   - _Mitigation_: Extensive testing and rollback plan
2. **Performance**: Additional transformation may impact build time
   - _Mitigation_: Benchmarking and optimization
3. **Compatibility**: Different browsers may interpret weights differently
   - _Mitigation_: Cross-browser testing

### **Rollback Plan**

1. Revert changes in source tokens
2. Complete system rebuild
3. Check component functionality
4. Document lessons learned

---

## ðŸ“… **Work Approach**

**Methodology**: Working in waves/sessions rather than fixed weekly schedules
**Current Wave**: Phase 1 - Analysis and Mapping
**Progress**: Item 1.1 - Mapping current transformation flow (IN PROGRESS)

---

## ðŸ”— **Dependencies**

### **Files to be Modified**

- `packages/tokens/transformers/base-config.mjs`
- `packages/tokens/transformers/build.mjs`
- `packages/tokens/transformers/build-unified.mjs`
- `packages/tokens/tokens/brand/ze/_other_elements.json`
- `packages/tokens/tokens/brand/theme_engine/_other_elements.json`
- `packages/ui/scripts/generate-css-vars.js`

### **Files to be Generated/Updated (Auto-generated)**

- `packages/tokens/dist/foundation/ze-foundation.*` (auto-generated by transformers)
- `packages/tokens/dist/semantic/ze-*-semantic.*` (auto-generated by transformers)
- `packages/tokens/dist/json/*.json` (auto-generated by transformers)
- `packages/tokens/dist/*.mjs` (auto-generated by transformers)
- `packages/tokens/dist/*.js` (auto-generated by transformers)
- `packages/tokens/dist/*.d.ts` (auto-generated by transformers)
- `packages/ui/src/styles/tokens.css` (auto-generated by CSS generator)

### **Affected Components**

- Button component (for validation)
- All components that use typography
- Typography Storybook stories

---

## ðŸ“š **Resources and References**

### **Technical Documentation**

- [Style Dictionary Transforms](https://amzn.github.io/style-dictionary/#/transforms)
- [CSS Font Weight Specification](https://developer.mozilla.org/en-US/docs/Web/CSS/font-weight)
- [Design Tokens W3C Specification](https://design-tokens.github.io/community-group/format/)

### **Reference Files**

- `.cursor/tokens/system-overview.md`
- `.cursor/tokens/build-process.md`
- `.memory/components/button/` (for validation)

---

## ðŸŽ¯ **Immediate Next Steps**

1. **Implement Style Dictionary transformation** - Create transform that converts names to numbers in `base-config.mjs`
2. **Update build scripts** - Modify `build.mjs` and `build-unified.mjs` to use new transform
3. **Update source tokens** - Modify JSON files to use numbers
4. **Test all platforms** - Verify JSON, MJS, JS, TS outputs all use numeric weights
5. **Update CSS generator** - Use numeric tokens from other platforms
6. **Validate with existing components** - Ensure compatibility across all outputs

---

**Status**: ðŸš§ Phase 1 - Analysis (Item 1.1: Mapping transformation flow)  
**Next Action**: Complete transformation flow mapping, then document affected files  
**Responsible**: Development Team  
**Review**: After each phase

---

_This plan will be updated according to progress and discoveries during implementation._
